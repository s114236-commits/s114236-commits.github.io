<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å­¸æ ¡åˆé¤é¸æ“‡å™¨</title>
  <style>
    body { font-family: system-ui, -apple-system, "Microsoft JhengHei", "Noto Sans TC", Arial; padding: 18px; background:#f7f7fb; color:#111; }
    .container { max-width:720px; margin:0 auto; background:#fff; padding:18px; border-radius:12px; box-shadow:0 6px 18px rgba(20,20,40,0.06); }
    h1 { margin-top:0; font-size:1.4rem; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    select, input[type="text"] { padding:8px; border-radius:8px; border:1px solid #ddd; min-width:160px; }
    button { padding:9px 12px; border-radius:10px; border:none; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
    button.primary { background:#0b79f7; color:white; }
    button.ghost { background:#eee; color:#111; }
    ul { padding-left:18px; }
    .result { margin-top:14px; padding:12px; border-radius:10px; background:linear-gradient(90deg,#fff,#f6fbff); border:1px solid #e6f0ff; font-weight:600; }
    .small { font-size:0.9rem; color:#555; }
    .chips { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
    .chip { padding:6px 8px; border-radius:999px; background:#f1f6ff; border:1px solid #e0e8ff; font-size:0.9rem; cursor:pointer; }
    .chip.active { background:#0b79f7; color:white; border-color:transparent; }
    .footer { margin-top:14px; font-size:0.85rem; color:#666; }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>å­¸æ ¡åˆé¤é¸æ“‡å™¨ ğŸ±</h1>
    <p class="small">é©åˆæ ¡å…§ï¼æ ¡åœ’å‘¨é‚Šæ–¹ä¾¿å–å¾—çš„åˆé¤é¸é …ã€‚å¯æ–°å¢é¸é …ã€ç”¨åå¥½ç¯©é¸ï¼Œæˆ–è®“ç³»çµ±å¹«ä½ éš¨æ©ŸæŒ‘ä¸€å€‹ã€‚</p>

    <div class="controls" aria-hidden="false">
      <select id="preset" title="å¿«é€Ÿé¸æ“‡é è¨­æ¸…å–®">
        <option value="default">é è¨­æ¸…å–®ï¼ˆæ ¡å…§ä¾¿ç•¶ã€ä¸‰æ˜æ²»ã€æ³¡éºµã€æ²™æ‹‰ç­‰ï¼‰</option>
        <option value="vegetarian">ç´ é£Ÿé¸å–®</option>
        <option value="cheap">ä½åƒ¹ä¾¿ç•¶ / å°åƒ</option>
      </select>

      <input id="newItem" type="text" placeholder="æ–°å¢ä¸€é …ï¼ˆä¾‹å¦‚ï¼šç‚¸é›ä¾¿ç•¶ï¼‰" />
      <button id="addBtn" class="ghost">æ–°å¢</button>

      <button id="randomBtn" class="primary">éš¨æ©ŸæŒ‘ä¸€å€‹</button>
      <button id="clearBtn" class="ghost">æ¸…é™¤è‡ªè¨‚</button>
    </div>

    <div class="chips" id="tags">
      <span class="chip active" data-tag="all">å…¨éƒ¨</span>
      <span class="chip" data-tag="cooked">ç†±é£Ÿ / ä¾¿ç•¶</span>
      <span class="chip" data-tag="fast">é€Ÿé£Ÿ / ä¸‰æ˜æ²»</span>
      <span class="chip" data-tag="noodle">éºµ / æ³¡éºµ</span>
      <span class="chip" data-tag="light">è¼•é£Ÿ / æ²™æ‹‰ / æ°´æœ</span>
      <span class="chip" data-tag="veg">ç´ é£Ÿ</span>
    </div>

    <div>
      <strong>å¯é¸é …ç›®ï¼ˆé»é¸å¯å•Ÿç”¨/åœç”¨ï¼‰</strong>
      <ul id="itemsList" aria-live="polite"></ul>
    </div>

    <div class="result" id="result" aria-live="polite">é‚„æ²’æŒ‘é¸å–”ï½æŒ‰ã€Œéš¨æ©ŸæŒ‘ä¸€å€‹ã€æˆ–é»é¸ä¸€é …ã€‚</div>

    <div class="footer">
      <div>æç¤ºï¼šé¸å–®æœƒå­˜åœ¨ç€è¦½å™¨ï¼ˆæœ¬æ©Ÿï¼‰ï¼Œä¸‹æ¬¡é–‹å•Ÿæœƒè¨˜å¾—ä½ ä¸Šæ¬¡æ–°å¢çš„é …ç›®èˆ‡ä¸Šæ¬¡æŒ‘é¸ã€‚</div>
      <div style="margin-top:6px;">å¦‚æœä½ æƒ³è¦æˆ‘æŠŠé è¨­é¸é …æ”¹ç‚ºæ›´è²¼è¿‘ä½ å­¸æ ¡çš„é¤é£²ï¼ˆä¾‹å¦‚å­¸æ ¡é¤å»³åç¨±ï¼‰ï¼Œç›´æ¥æŠŠåº—åæˆ–èœå–®è²¼çµ¦æˆ‘ï¼Œæˆ‘æœƒå¹«ä½ ä¿®æ”¹ã€‚</div>
    </div>
  </div>

  <script>
    // é è¨­é¸é …ï¼ˆä»¥å­¸æ ¡æ–¹ä¾¿å–å¾—ç‚ºä¸»ï¼‰
    const DEFAULTS = {
      default: [
        {name:'æ ¡å…§ä¾¿ç•¶ï¼ˆä¾¿ç•¶åº—ï¼‰', tags:['cooked']},
        {name:'æ ¡å…§è‡ªåŠ©é¤', tags:['cooked']},
        {name:'ä¸‰æ˜æ²» / åå¸', tags:['fast']},
        {name:'é£¯ç³° / é£¯ç³°åº—', tags:['fast']},
        {name:'æ³¡éºµï¼ˆå¾®æ³¢ï¼‰', tags:['noodle']},
        {name:'æ²™æ‹‰ / è”¬é£Ÿå§', tags:['light','veg']},
        {name:'æ»·å‘³æ”¤ / å°åƒè»Š', tags:['cheap','cooked']},
        {name:'ä¾¿ç•¶å¤–é€ï¼ˆå­¸æ ¡å¤–ï¼‰', tags:['cooked']},
        {name:'æ°´æœ+å„ªæ ¼', tags:['light','veg']},
        {name:'éºµç·š / æ¹¯éºµ', tags:['noodle']},
        {name:'å’–å“©é£¯æˆ–è“‹é£¯', tags:['cooked']},
        {name:'ç´ ä¾¿ç•¶ / ç´ é£Ÿ', tags:['veg','cooked']}
      ],
      vegetarian: [
        {name:'ç´ ä¾¿ç•¶ / ç´ é£Ÿé¤ç›’', tags:['veg','cooked']},
        {name:'æ²™æ‹‰å§', tags:['light','veg']},
        {name:'è±†çš®é£¯ç³°', tags:['fast','veg']},
        {name:'å‘³å™Œæ¹¯+é£¯', tags:['light','veg']}
      ],
      cheap: [
        {name:'æ»·è‚‰é£¯ / å°åƒ', tags:['cheap','cooked']},
        {name:'ä¾¿ç•¶ç‰¹åƒ¹', tags:['cheap','cooked']},
        {name:'å°è²©ç‚¸ç‰©', tags:['cheap','fast']},
        {name:'é—œæ±ç…®', tags:['cheap','cooked']}
      ]
    };

    // state
    let items = [];
    const STORAGE_KEY = 'school_lunch_picker_items_v1';
    const LAST_PICK_KEY = 'school_lunch_picker_last_v1';

    // dom
    const itemsList = document.getElementById('itemsList');
    const resultBox = document.getElementById('result');
    const newItemInput = document.getElementById('newItem');
    const addBtn = document.getElementById('addBtn');
    const randomBtn = document.getElementById('randomBtn');
    const clearBtn = document.getElementById('clearBtn');
    const preset = document.getElementById('preset');
    const chips = document.getElementById('tags');

    // load from storage or defaults
    function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          items = JSON.parse(raw);
        } catch(e) {
          items = DEFAULTS.default.slice();
        }
      } else {
        items = DEFAULTS.default.slice();
      }
      const last = localStorage.getItem(LAST_PICK_KEY);
      if (last) resultBox.textContent = 'ä¸Šæ¬¡é¸æ“‡ï¼š' + last;
      renderList();
    }

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    }

    function renderList(filterTag = 'all') {
      itemsList.innerHTML = '';
      items.forEach((it, idx) => {
        if (filterTag !== 'all' && !(it.tags || []).includes(filterTag)) return;
        const li = document.createElement('li');
        const chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.checked = true;
        chk.style.marginRight = '8px';
        chk.addEventListener('change', () => {
          // disabled => remove visually but keep in data by setting disabled flag
          it.disabled = !chk.checked;
          save();
        });
        const span = document.createElement('span');
        span.textContent = it.name + (it.tags && it.tags.length ? ' Â· ' + it.tags.join('/') : '');
        span.style.cursor = 'pointer';
        span.title = 'é»ä¸€ä¸‹å¿«é€Ÿé¸æ“‡é€™é …';
        span.addEventListener('click', () => {
          pickItem(it);
        });

        const del = document.createElement('button');
        del.textContent = 'åˆªé™¤';
        del.className = 'ghost';
        del.style.marginLeft = '8px';
        del.addEventListener('click', () => {
          if (confirm('ç¢ºå®šè¦åˆªé™¤ã€Œ' + it.name + 'ã€å—ï¼Ÿ')) {
            items.splice(idx,1);
            save();
            renderList(filterTag);
          }
        });

        li.appendChild(chk);
        li.appendChild(span);
        li.appendChild(del);
        itemsList.appendChild(li);
      });
      if (!itemsList.childElementCount) {
        itemsList.innerHTML = '<li class="small">æ²’æœ‰ç¬¦åˆçš„é¸é …ï¼ˆä½ å¯ä»¥æ–°å¢æˆ–åˆ‡æ›æ¨™ç±¤ï¼‰</li>';
      }
    }

    function pickItem(item) {
      resultBox.textContent = 'â†’ ' + item.name;
      localStorage.setItem(LAST_PICK_KEY, item.name);
    }

    randomBtn.addEventListener('click', () => {
      // collect enabled items currently visible (respect active tag)
      const activeChip = document.querySelector('.chip.active');
      const tag = activeChip ? activeChip.dataset.tag : 'all';
      const candidates = items.filter(it => !it.disabled && (tag === 'all' || (it.tags||[]).includes(tag)));
      if (!candidates.length) {
        resultBox.textContent = 'æ²’æœ‰å¯ç”¨é¸é …ï¼Œè«‹æ–°å¢æˆ–å–æ¶ˆåœç”¨é …ç›®ã€‚';
        return;
      }
      const i = Math.floor(Math.random() * candidates.length);
      pickItem(candidates[i]);
    });

    addBtn.addEventListener('click', () => {
      const v = newItemInput.value.trim();
      if (!v) return;
      // basic guess tags
      const lower = v.toLowerCase();
      const tags = [];
      if (lower.includes('æ²™æ‹‰') || lower.includes('æ°´æœ') || lower.includes('å„ªæ ¼')) tags.push('light');
      if (lower.includes('ç´ ') || lower.includes('veg')) tags.push('veg');
      if (lower.includes('æ³¡éºµ') || lower.includes('éºµ') || lower.includes('éºµç·š')) tags.push('noodle');
      if (lower.includes('ä¸‰æ˜æ²»') || lower.includes('åå¸') || lower.includes('é£¯ç³°')) tags.push('fast');
      if (lower.includes('ä¾¿ç•¶') || lower.includes('è“‹é£¯') || lower.includes('å’–å“©')) tags.push('cooked');
      items.unshift({name:v, tags: tags.length?tags:['cooked']});
      save();
      newItemInput.value = '';
      renderList(document.querySelector('.chip.active').dataset.tag || 'all');
    });

    clearBtn.addEventListener('click', () => {
      if (confirm('æœƒæ¸…é™¤ä½ æ‰€æœ‰è‡ªè¨‚é …ç›®ä¸¦é‚„åŸåˆ°é è¨­é¸å–®ï¼Œç¢ºå®šå—ï¼Ÿ')) {
        localStorage.removeItem(STORAGE_KEY);
        load();
      }
    });

    preset.addEventListener('change', () => {
      const val = preset.value;
      if (DEFAULTS[val]) {
        // ç”¨é¸å–çš„é è¨­è¦†è“‹ç›®å‰ listï¼ˆä½†ä¿ç•™ localStorage çš„è‡ªè¨‚å¯ç”±ä½¿ç”¨è€…åˆªé™¤ï¼‰
        items = DEFAULTS[val].slice();
        save();
        renderList(document.querySelector('.chip.active').dataset.tag || 'all');
      }
    });

    // chip (tag) click
    chips.addEventListener('click', (ev) => {
      const target = ev.target.closest('.chip');
      if (!target) return;
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      target.classList.add('active');
      renderList(target.dataset.tag);
    });

    // init
    load();
  </script>
</body>
</html>
